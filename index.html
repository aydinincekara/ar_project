<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bilişim Küpü (Final Sürüm)</title>
    
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        // =================================================================
        // BÖLÜM 1: CİHAZ ALGILAMA VE KONUMLANDIRMA (EN KRİTİK KISIM)
        // =================================================================
        AFRAME.registerComponent('mobil-ayar', {
            init: function () {
                // Ekran genişliği 768px'den küçükse "Mobil" kabul ediyoruz.
                var isMobile = window.matchMedia("(max-width: 768px)").matches;
                
                var kamera = document.querySelector('#ana-kamera');
                var model = document.querySelector('#kafes-sistemi'); // Küpümüz

                if (isMobile) {
                    // --- MOBİL TELEFON AYARLARI ---
                    // Amaç: AR'da gerçekçi dursun ama Web'de büyük görünsün.

                    // 1. BOYUT (SCALE): 0.3 = 30 cm. 
                    // AR modunda odaya koyduğumuzda dev gibi bina gibi durmasın, masa üstü obje gibi dursun.
                    model.setAttribute('scale', '0.3 0.3 0.3');

                    // 2. MODEL KONUMU (POSITION):
                    // Y=1.3: Yerden 1.3 metre yukarıda (İnsan göğüs hizası).
                    // Z=-1.5: Telefondan 1.5 metre ileride.
                    model.setAttribute('position', '0 1.3 -1.5');

                    // 3. KAMERA KONUMU:
                    // Küpü küçülttüğümüz (0.3) için web ekranında pire gibi görünür.
                    // Bu yüzden kamerayı Z=-0.5 yaparak küpün BİTİBİNE sokuyoruz.
                    // Böylece ekranda kocaman, AR'da ise normal görünüyor.
                    kamera.setAttribute('position', '0 1.3 -0.5');
                    
                } else {
                    // --- BİLGİSAYAR (MASAÜSTÜ) AYARLARI ---
                    // PC ekranı geniş, uzaktan bakmak daha estetik.
                    model.setAttribute('scale', '0.5 0.5 0.5'); // Daha büyük model
                    model.setAttribute('position', '0 0 0');     // Merkezde
                    kamera.setAttribute('position', '0 0 4');    // 4 Metre uzaktan bakış
                }
            }
        });

        // =================================================================
        // BÖLÜM 2: DÖNDÜRME MOTORU (MOUSE & DOKUNMATİK)
        // =================================================================
        AFRAME.registerComponent('akilli-kontrol', {
            schema: { speed: { default: 2.0 }, friction: { default: 0.95 } },
            init: function () {
                this.ifMouseDown = false;
                this.startX = 0;
                this.startY = 0;
                this.lastX = 0;
                this.lastY = 0;
                this.velocityX = 0; // Fırıldak etkisi için hız hafızası
                this.velocityY = 0;
                this.autoRotate = true; // Sayfa açılınca otomatik dönsün mü?

                // Olay Dinleyicilerini (Event Listeners) bağlıyoruz
                this.onStart = this.onStart.bind(this);
                this.onEnd = this.onEnd.bind(this);
                this.onMove = this.onMove.bind(this);

                // Hem Fare (Mouse) hem Parmak (Touch) desteği
                document.addEventListener('mousedown', this.onStart);
                document.addEventListener('touchstart', (e) => this.onStart(e.touches[0]), {passive: false}); // passive: false -> Sayfa kaymasını engeller
                
                document.addEventListener('mouseup', this.onEnd);
                document.addEventListener('touchend', this.onEnd);
                
                document.addEventListener('mousemove', this.onMove);
                document.addEventListener('touchmove', (e) => this.onMove(e.touches[0]), {passive: false});
            },

            // Dokunma Başladı
            onStart: function (e) {
                // Eğer kullanıcı menüye (modal) veya başlığa basıyorsa küpü döndürme!
                if(e.target && e.target.closest && (e.target.closest('.modal') || e.target.closest('.header'))) return;

                this.autoRotate = false; // Kullanıcı dokunduğu an otomatik dönmeyi durdur
                this.ifMouseDown = true;
                this.startX = e.clientX;
                this.startY = e.clientY;
                this.lastX = e.clientX;
                this.lastY = e.clientY;
                this.velocityX = 0; // Tutunca durdur
                this.velocityY = 0;
            },

            // Sürükleme Anı
            onMove: function (e) {
                if (this.ifMouseDown) {
                    var currentX = e.clientX;
                    var currentY = e.clientY;
                    var deltaX = currentX - this.lastX; // Ne kadar hareket etti?
                    var deltaY = currentY - this.lastY;

                    // Hızı hesapla (250 sayısı hassasiyet ayarıdır)
                    this.velocityY = deltaX * this.data.speed / 250; 
                    this.velocityX = deltaY * this.data.speed / 250;

                    this.lastX = currentX;
                    this.lastY = currentY;
                }
            },

            // Dokunma Bitti
            onEnd: function () { this.ifMouseDown = false; },

            // Her karede (frame) çalışır: Animasyon
            tick: function () {
                if (!this.ifMouseDown) {
                    if(this.autoRotate) { 
                        // Otomatik Dönüş (Vitrin Modu)
                        this.el.object3D.rotation.y += 0.003; 
                    } 
                    else {
                        // Eylemsizlik (Sürtünme ile yavaşça durma)
                        this.velocityX *= this.data.friction;
                        this.velocityY *= this.data.friction;
                        this.el.object3D.rotation.y += this.velocityY;
                        this.el.object3D.rotation.x += this.velocityX;
                    }
                }
            }
        });

        // =================================================================
        // BÖLÜM 3: TIKLAMA VE BİLGİ PENCERESİ AÇMA
        // =================================================================
        AFRAME.registerComponent('tiklama-efekti', {
            init: function () {
                var el = this.el; // Tıklanan yüzey
                el.addEventListener('click', function (evt) {
                    // HTML'deki 'data-modal="modal-1"' bilgisini okur
                    var hedefModal = el.getAttribute('data-modal');
                    modalAc(hedefModal); // O pencereyi açar
                });
            }
        });
    </script>

    <style>
        /* CSS / GÖRSEL TASARIM */
        
        /* Sayfa kaymasını engellemek için touch-action: none ve overflow: hidden şart */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; touch-action: none; font-family: 'Segoe UI', sans-serif; }
        
        /* Arayüz Katmanı (UI Layer) */
        /* pointer-events: none sayesinde bu katmanın arkasındaki 3D küpe dokunabiliyoruz */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; background: radial-gradient(circle, rgba(0,0,0,0) 0%, rgba(0,0,0,0.6) 100%); }

        /* Başlık Yazıları */
        .header { text-align: center; margin-top: 50px; pointer-events: none; }
        .header h1 { margin: 0; font-size: 2.2rem; color: #fff; text-shadow: 0 2px 10px #000; }
        .header p { color: #ff9f43; margin-top: 5px; font-size: 1.1rem; font-weight: bold; }

        /* Modal (Bilgi Penceresi) Tasarımı */
        .modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            width: 90%; max-width: 400px; 
            background: rgba(20, 25, 30, 0.95); /* Koyu Yarı Saydam Arkaplan */
            border: 2px solid rgba(255, 159, 67, 0.6); 
            border-radius: 20px; padding: 30px; 
            color: white; display: none; opacity: 0; 
            pointer-events: auto; /* Pencereye tıklanabilsin */
            z-index: 20; 
            box-shadow: 0 0 50px rgba(0,0,0,0.8); transition: 0.2s;
        }
        
        .modal.aktif { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .modal h2 { margin-top: 0; color: #ff9f43; border-bottom: 1px solid #444; padding-bottom: 15px; font-size: 1.6rem; }
        .modal ul { padding-left: 20px; color: #ccc; font-size: 1.1rem; line-height: 1.6; }
        .kapat-btn { background: #ff4757; color: white; border: none; width: 100%; padding: 18px; border-radius: 12px; font-weight: bold; font-size: 1.1rem; margin-top: 20px; cursor: pointer; }
    </style>
</head>

<body>

    <div id="ui-layer">
        <div class="header">
            <h1>BİLİŞİM KÜPÜ</h1>
            <p>Döndür ve Yüzeye Dokun</p>
        </div>
    </div>

    <div id="modal-1" class="modal"><h2>Maker & STEM</h2><ul><li>Tinkercad Tasarım</li><li>3D Kalem Atölyesi</li><li>Proje Kültürü</li></ul><button class="kapat-btn" onclick="modalKapat()">KAPAT</button></div>
    <div id="modal-2" class="modal"><h2>Robotik & Kod</h2><ul><li>Arduino Devreleri</li><li>mBlock Kodlama</li><li>Sensör Kullanımı</li></ul><button class="kapat-btn" onclick="modalKapat()">KAPAT</button></div>
    <div id="modal-3" class="modal"><h2>Yazılım</h2><ul><li>Python ile AI</li><li>Unity Oyun Yapımı</li><li>Algoritma Mantığı</li></ul><button class="kapat-btn" onclick="modalKapat()">KAPAT</button></div>
    <div id="modal-4" class="modal"><h2>Hackoutlon</h2><ul><li>Proje Yönetimi</li><li>Takım Çalışması</li><li>Sunum Teknikleri</li></ul><button class="kapat-btn" onclick="modalKapat()">KAPAT</button></div>
    <div id="modal-5" class="modal"><h2>3D Baskı</h2><ul><li>Cura Dilimleme</li><li>Baskı Teknikleri</li><li>Filament Bilgisi</li></ul><button class="kapat-btn" onclick="modalKapat()">KAPAT</button></div>
    <div id="modal-6" class="modal"><h2>3D Tarama</h2><ul><li>Fotogrametri</li><li>Dijitalleştirme</li><li>Lidar Tarama</li></ul><button class="kapat-btn" onclick="modalKapat()">KAPAT</button></div>

    <a-scene background="color: #050505" cursor="rayOrigin: mouse" raycaster="objects: .tiklanabilir" mobil-ayar>
        
        <a-light type="ambient" intensity="1.2"></a-light>
        <a-light type="directional" position="1 2 3" intensity="1.5"></a-light>
        <a-light type="point" position="-2 1 2" color="#ff9f43" intensity="0.8"></a-light>

        <a-assets>
            <a-asset-item id="kupu" src="egitim_kupu.glb"></a-asset-item>
        </a-assets>

        <a-entity id="kafes-sistemi" position="0 0 0" scale="0.5 0.5 0.5" akilli-kontrol>
            
            <a-entity gltf-model="#kupu" position="0 -0.2 0"></a-entity>

            <a-plane class="tiklanabilir" data-modal="modal-1" tiklama-efekti position="0 0 0.51" width="1" height="1" material="opacity: 0.01; transparent: true"></a-plane>
            <a-plane class="tiklanabilir" data-modal="modal-2" tiklama-efekti position="0.51 0 0" rotation="0 90 0" width="1" height="1" material="opacity: 0.01; transparent: true"></a-plane>
            <a-plane class="tiklanabilir" data-modal="modal-3" tiklama-efekti position="0 0 -0.51" rotation="0 180 0" width="1" height="1" material="opacity: 0.01; transparent: true"></a-plane>
            <a-plane class="tiklanabilir" data-modal="modal-4" tiklama-efekti position="-0.51 0 0" rotation="0 -90 0" width="1" height="1" material="opacity: 0.01; transparent: true"></a-plane>
            <a-plane class="tiklanabilir" data-modal="modal-5" tiklama-efekti position="0 0.51 0" rotation="-90 0 0" width="1" height="1" material="opacity: 0.01; transparent: true"></a-plane>
            <a-plane class="tiklanabilir" data-modal="modal-6" tiklama-efekti position="0 -0.51 0" rotation="90 0 0" width="1" height="1" material="opacity: 0.01; transparent: true"></a-plane>

        </a-entity>

        <a-camera id="ana-kamera" position="0 0 4" look-controls="enabled: false" wasd-controls="enabled: false"></a-camera>

    </a-scene>

    <script>
        // Modal Açma/Kapama Fonksiyonları
        function modalKapat() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('aktif')); }
        function modalAc(id) { modalKapat(); document.getElementById(id).classList.add('aktif'); }
    </script>
</body>
</html>
