<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sabit Merkezli Küp</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        // --- SADECE KÜPÜ DÖNDÜREN MOTOR ---
        AFRAME.registerComponent('akilli-kontrol', {
            schema: { speed: { default: 2.0 }, friction: { default: 0.95 } },
            init: function () {
                this.ifMouseDown = false;
                this.startX = 0;
                this.startY = 0;
                this.velocityX = 0;
                this.velocityY = 0;
                this.isDragging = false;
                this.autoRotate = true;

                // Bindings
                this.onStart = this.onStart.bind(this);
                this.onEnd = this.onEnd.bind(this);
                this.onMove = this.onMove.bind(this);

                // Event Listeners (Tüm ekranı dinliyoruz)
                document.addEventListener('mousedown', this.onStart);
                document.addEventListener('touchstart', (e) => this.onStart(e.touches[0]), {passive: false});
                
                document.addEventListener('mouseup', this.onEnd);
                document.addEventListener('touchend', this.onEnd);
                
                document.addEventListener('mousemove', this.onMove);
                document.addEventListener('touchmove', (e) => this.onMove(e.touches[0]), {passive: false});
            },

            onStart: function (e) {
                // UI butonlarına basıldıysa küpü elleme
                if(e.target && e.target.closest && (e.target.closest('.modal') || e.target.closest('.header'))) return;

                this.autoRotate = false;
                this.ifMouseDown = true;
                this.startX = e.clientX;
                this.startY = e.clientY;
                this.lastX = e.clientX;
                this.lastY = e.clientY;
                this.isDragging = false;
                this.velocityX = 0;
                this.velocityY = 0;
            },

            onMove: function (e) {
                if (this.ifMouseDown) {
                    // Sayfanın kaymasını engelle (Mobilde çok önemli)
                    // e.preventDefault(); // (Bazı tarayıcılarda hata verebilir, CSS ile çözdük)

                    var currentX = e.clientX;
                    var currentY = e.clientY;

                    if (Math.abs(currentX - this.startX) > 5 || Math.abs(currentY - this.startY) > 5) {
                        this.isDragging = true;
                    }

                    var deltaX = currentX - this.lastX;
                    var deltaY = currentY - this.lastY;

                    // Hız Ayarı
                    this.velocityY = deltaX * this.data.speed / 300; 
                    this.velocityX = deltaY * this.data.speed / 300;

                    this.lastX = currentX;
                    this.lastY = currentY;
                }
            },

            onEnd: function () {
                this.ifMouseDown = false;
            },

            tick: function () {
                if (!this.ifMouseDown) {
                    if (this.autoRotate) {
                        this.el.object3D.rotation.y += 0.002; 
                    } else {
                        this.velocityX *= this.data.friction;
                        this.velocityY *= this.data.friction;
                        this.el.object3D.rotation.y += this.velocityY;
                        this.el.object3D.rotation.x += this.velocityX;
                    }
                }
            }
        });

        // --- TIKLAMA EFEKTİ ---
        AFRAME.registerComponent('tiklama-efekti', {
            init: function () {
                var el = this.el;
                var wrapper = document.querySelector('#donen-merkez');
                el.addEventListener('click', function () {
                    var hedefModal = el.getAttribute('data-modal');
                    modalAc(hedefModal);
                    wrapper.setAttribute('animation', {
                        property: 'scale', from: '1 1 1', to: '1.15 1.15 1.15', dur: 150, dir: 'alternate', loop: 1, easing: 'easeOutQuad'
                    });
                });
            }
        });
    </script>

    <style>
        /* --- EKRAN KAYMASINI ENGELLEYEN CSS --- */
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; 
            touch-action: none; /* Mobilde parmakla sayfa kaydırmayı kapatır */
        }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
            background: radial-gradient(circle, rgba(0,0,0,0) 20%, rgba(0,0,0,0.9) 90%);
        }

        .header { text-align: center; margin-top: 40px; pointer-events: none; }
        .header h1 { margin: 0; font-size: 2rem; color: #fff; text-shadow: 0 0 10px #000; letter-spacing: 3px; }
        .header p { color: #ff9f43; margin-top: 5px; font-weight: bold; }

        /* MODAL STILLERİ */
        .modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            width: 85%; max-width: 350px; background: rgba(25, 30, 35, 0.95);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 25px; 
            color: white; display: none; opacity: 0; pointer-events: auto; z-index: 20; 
            box-shadow: 0 20px 60px rgba(0,0,0,1); transition: 0.3s;
        }
        .modal.aktif { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .modal h2 { margin-top: 0; color: #ff9f43; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .modal ul { padding-left: 20px; line-height: 1.6; color: #ccc; }
        .kapat-btn { background: #ff4757; color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; margin-top: 15px; cursor: pointer; }

    </style>
</head>

<body>

    <div id="ui-layer">
        <div class="header">
            <h1>BİLİŞİM KÜPÜ</h1>
            <p>Döndür ve Dokun</p>
        </div>
    </div>

    <div id="modal-ar" class="modal"><h2>AR (Artırılmış Gerçeklik)</h2><p>Duvarları dijitalleştirin.</p><ul><li>3D Sergiler</li><li>Bilim Deneyleri</li></ul><button class="kapat-btn" onclick="modalKapat()">Kapat</button></div>
    <div id="modal-vr" class="modal"><h2>VR (Sanal Gerçeklik)</h2><p>Sınıftan çıkmadan gezin.</p><ul><li>Sanal Müzeler</li><li>VEXcode VR</li></ul><button class="kapat-btn" onclick="modalKapat()">Kapat</button></div>
    <div id="modal-stem" class="modal"><h2>STEM & Maker</h2><p>Tasarla ve Üret.</p><ul><li>3D Kalem</li><li>Tinkercad</li></ul><button class="kapat-btn" onclick="modalKapat()">Kapat</button></div>
    <div id="modal-ai" class="modal"><h2>Yapay Zeka</h2><p>Geleceği kodlayın.</p><ul><li>Teachable Machine</li><li>Python AI</li></ul><button class="kapat-btn" onclick="modalKapat()">Kapat</button></div>
    <div id="modal-print" class="modal"><h2>3D Baskı</h2><p>Fikirden ürüne.</p><ul><li>Cura Dilimleme</li><li>Baskı Teknikleri</li></ul><button class="kapat-btn" onclick="modalKapat()">Kapat</button></div>
    <div id="modal-scan" class="modal"><h2>3D Tarama</h2><p>Nesneleri dijitalleştirin.</p><ul><li>Fotogrametri</li><li>Lidar Tarama</li></ul><button class="kapat-btn" onclick="modalKapat()">Kapat</button></div>

    <a-scene background="color: #000" cursor="rayOrigin: mouse" raycaster="objects: .tiklanabilir">
        
        <a-light type="ambient" intensity="0.6"></a-light>
        <a-light type="directional" position="2 2 2" intensity="1.2"></a-light>
        <a-light type="point" position="-2 2 2" color="#ff9f43" intensity="0.5"></a-light>

        <a-assets>
            <a-asset-item id="kupu" src="egitim_kupu.glb"></a-asset-item>
        </a-assets>

        <a-entity id="donen-merkez" position="0 0 -3.5" akilli-kontrol>
            
            <a-entity gltf-model="#kupu" scale="0.5 0.5 0.5" position="0 -0.2 0"></a-entity>

            <a-plane class="tiklanabilir" data-modal="modal-ar" tiklama-efekti position="0 0 0.51" width="1" height="1" material="color:red; opacity:0; transparent:true"></a-plane>
            <a-text value="AR" align="center" position="0 0 0.52" scale="2 2 2"></a-text>

            <a-plane class="tiklanabilir" data-modal="modal-vr" tiklama-efekti position="0.51 0 0" rotation="0 90 0" width="1" height="1" material="color:blue; opacity:0; transparent:true"></a-plane>
            <a-text value="VR" align="center" position="0.52 0 0" rotation="0 90 0" scale="2 2 2"></a-text>

            <a-plane class="tiklanabilir" data-modal="modal-stem" tiklama-efekti position="0 0 -0.51" rotation="0 180 0" width="1" height="1" material="color:yellow; opacity:0; transparent:true"></a-plane>
            <a-text value="STEM" align="center" position="0 0 -0.52" rotation="0 180 0" scale="2 2 2"></a-text>

            <a-plane class="tiklanabilir" data-modal="modal-ai" tiklama-efekti position="-0.51 0 0" rotation="0 -90 0" width="1" height="1" material="color:purple; opacity:0; transparent:true"></a-plane>
            <a-text value="AI" align="center" position="-0.52 0 0" rotation="0 -90 0" scale="2 2 2"></a-text>

            <a-plane class="tiklanabilir" data-modal="modal-print" tiklama-efekti position="0 0.51 0" rotation="-90 0 0" width="1" height="1" material="color:orange; opacity:0; transparent:true"></a-plane>
            <a-text value="3D BASKI" align="center" position="0 0
